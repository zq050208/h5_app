<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <!-- <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> -->
    <title></title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.3.0/video-js.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/share_video.css">
    <link rel="stylesheet" href="../public/mescroll.min.css">
</head>

<body>
    <div class="videoMain">
        <div style="width: 100%; background: url('image/icon-shareBG.png') no-repeat 100%/100%;">
            <div class="navigation between" onclick="goApp(2,config.content_id)">
                <div><img src="image/icon-smallLogo.png" alt="" class="logo">小虎Hoo电竞</div>
                <div class="download">下载APP</div>
            </div>
        </div>
        <div class="top">
            <div class="videoContent">

            </div>
        </div>
        <div class="tab">
            <div class="tabTitle">
                <div class="tabItem commentLength">评论</div>
                <div class="tabItem">简介</div>
            </div>
            <div class="tabContent" style="margin-bottom:55px">
                <div id="mescroll" class="mescroll">
                    <div>
                        <ul class="listContent"  onclick="goApp(2,config.content_id)">
                           
                        </ul>
                    </div>
                </div>

                <div class="briefMsg">
                    <div class="briefConetnt">
                        <div class="briefTop">
                            <div style="display: flex;" onclick="goApp(2,config.content_id)">
                                <img src="" alt="" class="avotor">
                                <div style="width: 100%; color:rgba(153,153,153,1);">
                                    <div class="between">
                                        <div><span class="nickname"> </span><img style="margin-left: 5px;" src="image/icon-videoAttion.png" alt=""
                                                class="attention"></div>
                                        <img src="image/icon-more.png" alt="" class="more">
                                    </div>
                                    <span style="font-size:12px;" class="create_time"></span>
                                </div>
                            </div>
                            <div style="display: flex; margin-top: 7px;">
                                <div style="margin-left: 50px;">
                                    <div style="display: flex;"><div class="titleContent titleMsg"></div><img src="image/icon-downlow.png" alt="" class="downown"></div>
                                    <div class="introduce"></div>
                                </div>
                            </div>
                            <div class="briefIcon">
                                <!-- <div><img src="image/icon-briefPlay_defalut.png" alt=""><span class="view_num"></span></div> -->
                                <div><img src="image/icon-briefCollet_defalut.png" alt=""><span class="collect_num"></span></div>
                                <div><img src="image/icon-briefLikeup_defalut.png" alt=""><span class="like_num"></span> </div>
                                <div><img src="image/icon-briefShare.png" alt=""><span class="share_num"></span></div>
                            </div>
                        </div>
                        <div class="recommend">
                            <div style="color:rgba(153,153,153,1);">精彩推荐</div>
                                <div>
                                    <ul class="sublistContent" >
                                        <script type="text/html" id="gameContenList">
                                        {{each item value }}
                                        <div class="recommendItem" onclick="goApp({{value.type ==2 ? 2: 1 }},{{value.id}})">
                                            <div class="recommend_left vertical">
                                                <span class="recommend_title titleMsg">{{value.title}}</span>
                                                <div class="recommend_bottom titleMsg ">{{value.name}} </div>
                                            </div>
                                            <div class="recommend_right">
                                                <img src="{{value.cover}}" alt="" class="recommend_img">
                                                {{if value.type == 2}}
                                                <span class="play">{{value.video_length+':00'}}</span>
                                                {{/if}}
                                            </div>
                                        </div>
                                        {{/each}}
                                    </script>
                                    </ul>
                                </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 底部 -->
        <div class="bottom">
            <div class="bottomMsg between" onclick="goApp(2,config.content_id)">
                <input type="text">
                <div>
                    <img src="image/icon-bigGiveLike_defalt.png" alt="" class="is_like">
                    <img style="margin: 0 15px;" src="image/icon-collect_defalt.png" alt="" class="is_collect">
                    <img src="image/icon-share.png" alt="">
                </div>
            </div>
        </div>
    </div>
    <!-- 下载 -->
    <div class="shareModal" style=" position: fixed; width: 100%; height: 100%; top: 0; left: 0; background:rgba(0,0,0,0.5);  display: none;">
        <img src="image/icon-guidance.png" alt=""  style=" width: 53vw;  height: 38.6vw; position: fixed; right: 47px; top: 16px;">
    </div>
    <div style="display: none;">
        <script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1278943282'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1278943282' type='text/javascript'%3E%3C/script%3E"));</script>
    </div>
</body>

</html>
<script src="../public/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.3.0/video.min.js"></script>
<script src="../public/config.js"></script>
<script src="../public/service.js"></script>
<script src="../public/mescroll.min.js"></script>
<script src="../public/template-web.js"></script>
<script type="text/html" id="commentList">
    {{each item  v i}}
<div class="commentMsg">
    <img class="avotor" src="{{v.avatar}}" alt="">
    <div class="commentConetnt">
        <div class="between">
            <div><span style="color:rgba(153,153,153,1);">{{v.nickname}}
                {{if $imports.user_id == v.user_id }}
                <span class="author">作者</span>
                {{/if}}
            </span><img class="{{v.like_num >= 50 && 2.5*v.comment_num >= 50 && comment_user_num >= 10 ? 'hot' : 'nohot' }}" src="image/icon-commentHot.png" alt=""></div>
            <img class="more" src="image/icon-more.png" alt="">
        </div>
        <div class="commetDetails vertical">{{v.content}}</div>
        <div class="commentIcon between">
            <span>{{getDateDiff(v.create_time)}}</span>
            <div style="display: flex; margin-right:10px">
                <div style="display: flex; margin-right: 20px; align-items: center;"><img src="image/icon-smallGivelike_defalt.png" alt="" class="likeup">{{v.like_num}}
                </div>
                <div style="display: flex; align-items: center;"><img src="image/icon-message.png" alt="" class="likeup">{{v.comment_num}}</div>
            </div>
        </div>
        <div class="{{v.replys.length ? 'replyConetent' : 'noreplyConetent'}}">
            {{each v.replys sub index}}
            {{if index <=2}}
            <div class="reply_item vertical"><span class="replyAuthor ">{{sub.replysUserinfo.nickname}}：</span>{{sub.content}}</div>
            {{/if}}
            {{/each}}
            <div style="color:rgba(255,204,3,1);" class="{{v.replys.length >=3 ? 'lookall' : 'nolookall'}}">查看全部 {{v.comment_num}} 条回复</div>
        </div>
    </div>
</div>
{{/each}}
</script>
<script>
    var config = {
        contentUrl: 'Content/getContentInfo',
        type: 'get',
        contentInfoData: {
            content_id: Request('content_id')
        },
        user_id: Request('user_id'),
        commentUrl: 'Comment/indexComment',
        commentData: {
            content_id: Request('content_id'),
            page: 1,
            per_page: 10
        },
        getGameContentUrl: 'recommend/getIntroContentList',
        getGameContenDarta: {
            content_id: Request('content_id')
        },
        changeViewLength: 'Content/changeViewLength',
        changeViewData: {
            // view_log_id: null,
            start_time: '',
            end_time: ''
        },
        mescroll: initMescroll(),
        up: 'up',
        flush: 'flush',
        isClick: false,
        content_id: Number(Request('content_id'))
    }
    config.changeViewData.start_time = new Date(+new Date()+8*3600*1000).toISOString().replace(/T/g,' ').replace(/\.[\d]{3}Z/,'')
    requsetHttp(config.contentUrl, config.type, config.contentInfoData, null, (res) => {
        if (res.code == 200) {
            $(".videoContent").html(` <video id="example_video_1" class="video-js vjs-default-skin" preload="none" poster="${res.data.cover}" playsinline webkit-playsinline x5-playsinline x-webkit-airplay>
                 <source src="${res.data.video_url}" type="video/mp4">
                </video>`)
        var player = videojs('example_video_1', {
            muted: false,
            controls: true / false,
            loop: true,
            // 更多配置.....
        });
        $("title").text('小虎Hoo电竞'+res.data.title)
        $(".avotor").attr('src', res.data.avatar)
        $(".nickname").text(res.data.nickname)
        $(".create_time").text(changeTime(res.data.create_time)+'发布')
        $(".titleMsg").text(res.data.title)
        $(".is_like").attr('src', res.data.is_like == 1 ? 'image/icon-bigGiveLike.png' : 'image/icon-bigGiveLike_defalt.png')
        $(".is_collect").attr('src', res.data.is_collect == 1 ? 'image/icon-collect_active.png' : 'image/icon-collect_defalt.png')
        $(".commentLength").text('评论' + `(${returnNum(res.data.comment_num)})`)
        $(".view_num").text(returnNum(res.data.view_num))
        $(".collect_num").text(returnNum(res.data.collect_num))
        $(".like_num").text(returnNum(res.data.like_num))
        $(".share_num").text(returnNum(res.data.share_num))
        $(".introduce").html(res.data.introduce)
        config.changeViewData.view_log_id = res.data.view_log_id
        }
    })
    $(".introduce").slideUp()
    $(".downown, .titleContent").click(function () {
      if (config.isClick == false){
          $(".introduce").slideDown()
          config.isClick = true
          $('.downown').attr('src','image/icon-downup.png')
      } else {
          $(".introduce").slideUp()
          config.isClick = false
          $('.downown').attr('src','image/icon-downlow.png')
      }
            
    })

    $(".tabItem").eq(0).addClass("active")
    getRecommend()
    $(".tabItem").click(function () {
        $(this).addClass("active").siblings().removeClass('active')
        config.commentData.page = 1
        if ($(this).index() == 1) {
            $(".mescroll").hide()
            $('.briefMsg').show()
            $(".bottom").hide()
        } else {
            $('.briefMsg').hide()
            $(".mescroll").show()
            $('.bottom').show()
            getCommentList(config.flush)
        }
    })

    $(".shareModal").click(function () {
        $(".shareModal").hide()
    })
    // 获取列表数据 
    function getCommentList(type) {
        if (type == "flush") {
            config.mescroll.optUp.page.num = 1;
            config.commentData.page = 1
        }
        config.mescroll.setPageSize(config.commentData.per_page)
        requsetHttp(config.commentUrl, config.type, config.commentData, null, (res) => {
           if (res.code == 200) {
            if (!res.data.data.length) $(".mescroll").html('<div style="padding: 50px 0;display:flex;justify-content: center; align-items: center;">暂无数据</div>')
            var list = template('commentList', { item: res.data.data })
            if (type == config.flush) {
                $(".listContent").empty()
                config.mescroll.optUp.page.num = 1;
                config.mescroll.setPageNum(config.commentData.page)
                config.mescroll.endByPage(res.data.data.length, res.data.last_page);
                $(".listContent").html(list)
            } else {
                config.mescroll.endByPage(res.data.data.length, res.data.last_page);
                $(".listContent").append(list)
            }
            config.commentData.page++
           }
        })
    }
    // 获取推荐数据
    function getRecommend () {
        requsetHttp(config.getGameContentUrl, config.type,config.getGameContenDarta, null, (res) => {
            if (res.code == 200) {
                var gamelist = template('gameContenList', { item: res.data })
                $(".sublistContent").html(gamelist)
            }
        })
    }

    
    window.addEventListener("onbeforeunload ", function (event) {
        var data = confirm('确定关闭？')
        if (data == true) {
          config.changeViewData.end_time = new Date(+new Date()+8*3600*1000).toISOString().replace(/T/g,' ').replace(/\.[\d]{3}Z/,'') 
          changeViewLength()
        }
    })


    // 更新查看内容的浏览时长
    function changeViewLength() {
        requsetHttp(config.changeViewLength,config.type, config.changeViewData,null, (res)=> {})
    }


    // template 导出方法、参数
    template.defaults.imports.getDateDiff = getDateDiff
    template.defaults.imports.user_id = config.user_id

    /**
* mescroll 配置
*/
    function initMescroll() {
        var mescroll = new MeScroll("mescroll", {
            up: {
                callback: upCallback,
                isBounce: true,
                noMoreSize: 5,
                auto: false,
                htmlNodata: '<p class="upwarp-nodata">没有更多了</p>',
                loadFull:{
                    delay : 500
                }
            },
            down: {
                // auto: false,
                callback: downCallback
            }
        });
        return mescroll;
    }

    /**
     * 下拉刷新的回调
     */
    function downCallback() {
        getCommentList(config.flush);
    }

    /**
     * 上拉加载的回调
     */
    function upCallback() {
        getCommentList(config.up);
    }

</script>